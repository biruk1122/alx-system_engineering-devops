#!/usr/bin/env bash
# This script ensures Nginx is configured to listen on port 80

# Check if Nginx is running
if ! systemctl is-active --quiet nginx; then
    echo "Nginx is not running. Starting Nginx..."
    sudo systemctl start nginx
fi

# Check if Nginx is listening on port 80
if ! curl -s localhost:80 > /dev/null; then
    echo "Nginx is not listening on port 80. Configuring Nginx..."
    
    # Modify Nginx configuration to listen on port 80
    sudo sed -i '/listen\s*80;/d' /etc/nginx/sites-available/default
    sudo sed -i '/listen\s*\[::\]:80;/d' /etc/nginx/sites-available/default
    echo "    listen 80;" | sudo tee -a /etc/nginx/sites-available/default > /dev/null

    # Reload Nginx to apply the changes
    sudo systemctl reload nginx

    # Verify if Nginx is now listening on port 80
    if ! curl -s localhost:80 > /dev/null; then
        echo "Failed to configure Nginx to listen on port 80"
        exit 1
    else
        echo "Nginx is now listening on port 80"
    fi
else
    echo "Nginx is already listening on port 80"
fi
